<TfStateManager {{did-insert this.filterOptions}} as |state|>
  <TfSelect>
    <TfSelectContainer @onInsert={{fn state.onInsert}}
                       @onDestroy={{fn state.onDestroy}}>
      <TfControl class={{state.focused}}>
        <TfMultiValueContainer @onClick={{fn state.openMenu}}
                               @onDblClick={{fn state.onInputDblClick}}
                               @onMouseDown={{fn state.onInputMouseDown}}>
          {{#if state.isMulti}}
            {{#each state.selectedOptions as |option|}}
              <TfMultiValue @value={{option.value}}>
                <TfMultiValueLabel>{{option.label}}</TfMultiValueLabel>
                <TfMultiValueRemove @onClick={{fn state.removeOption option}}>
                  <TfCrossIcon @size={{14}} />
                </TfMultiValueRemove>
              </TfMultiValue>
            {{/each}}
          {{/if}}
          <TfInput>
            <AutosizeInput @onBlur={{fn state.onBlur}}
                           @onClick={{fn state.openMenu}}
                           @onFocus={{fn state.focus}}
                           @onInput={{fn state.filterOptions}}
                           @onKeyDown={{fn state.handleAccelerator}}
                           @placeholder={{state.placeholder}}
                           @value={{state.value}} />
          </TfInput>
        </TfMultiValueContainer>
        <TfIndicatorsContainer>
          {{#if state.isValuePresent}}
            <TfClearIndicator @onClick={{fn state.clearValue}}>
              <TfCrossIcon />
            </TfClearIndicator>
          {{/if}}
          {{#if state.isLoading}}
            <TfLoadingIndicator>
              <TfLoadingDot />
              <TfLoadingDot />
              <TfLoadingDot />
            </TfLoadingIndicator>
          {{/if}}
          <TfIndicatorSeparator />
          <TfDropdownIndicator @onClick={{fn state.openMenu}}>
            <TfDownChevron />
          </TfDropdownIndicator>
        </TfIndicatorsContainer>
      </TfControl>
      {{#if state.isMenuOpen}}
        <TfMenu>
          <TfMenuList>
            {{#if state.isLoading}}
              <TfOption @isDisabled={{true}}>Loading...</TfOption>
            {{else}}
              {{#each state.filteredOptions as |option|}}
                <TfOption @isActive={{eq option state.activeOption}}
                          @isHovered={{eq option state.hoveredOption}}
                          @isSelected={{eq option state.selectedOption}}
                          @value={{option}}
                          @onActivateStart={{fn state.activateOption}}
                          @onActivateEnd={{fn state.deactivateOption}}
                          @onHoverStart={{fn state.hoverOption}}
                          @onHoverEnd={{fn state.dehoverOption}}
                          @onSelect={{fn state.selectOption}}>
                  {{option.label}}
                </TfOption>
              {{else}}
                <TfOption @isDisabled={{true}}>No Options</TfOption>
              {{/each}}
            {{/if}}
          </TfMenuList>
        </TfMenu>
      {{/if}}
    </TfSelectContainer>
  </TfSelect>
</TfStateManager>
